language: c
sudo: require
compiler:
  - clang
git:
  depth: 5
build:
  pre_ci_boot:
    image_name: drydock/u14cppall
    image_tag: tip

install:
  - shippable_retry sudo add-apt-repository ppa:beineri/opt-qt593-trusty -y
  - shippable_retry sudo apt-get -y -qq update
  - shippable_retry sudo apt-get -y install cmake qt59base qt59webengine qt59x11extras
  - source /opt/qt*/bin/qt*-env.sh
  - export PATH=/opt/qt59/bin:$PATH
  - SRC="cmake-build-relwithdebinfo"
  - CMAKE_NAME="TimeCampDesktop"

before_script:
  - cp CMakeProjectConfig.cmake.example CMakeProjectConfig.cmake

script:
  - cd $SRC
  - cmake -DCMAKE_BUILD_TYPE=RelWithDebInfo -G "Unix Makefiles" "../"
  - cd ../
  - cmake --build $SRC --target "${CMAKE_NAME}" --

branches:
  except:
    - # Do not build tags that we create when we upload to GitHub Releases
    - /^(?i:continuous)/
